<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta name="loginType" th:content="${loginType}">
    <title>Welcome</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* ì „ì²´ í˜ì´ì§€ ìŠ¤íƒ€ì¼ */
        body {
            background-color: #f8f9fa;
            font-family: 'Arial', sans-serif;
        }

        .container {
            max-width: 800px;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin: 50px auto;
            text-align: center;
        }

        /* í—¤ë” ìŠ¤íƒ€ì¼ */
        .header {
            background: black;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .header-title {
            font-size: 22px;
            font-weight: bold;
        }

        /* ë²„íŠ¼ ê³µí†µ ìŠ¤íƒ€ì¼ */
        .btn-custom {
            display: inline-block;
            padding: 12px 20px;
            font-size: 16px;
            border-radius: 6px;
            border: none;
            font-weight: bold;
            transition: 0.3s ease-in-out;
            text-decoration: none;
        }

        /* ê¸°ë³¸ ë²„íŠ¼ ìŠ¤íƒ€ì¼ (ê²€ì •) */
        .btn-dark {
            background-color: black;
            color: white;
        }

        .btn-dark:hover {
            background-color: #333;
        }

        /* í—¤ë” ë²„íŠ¼ ê³µí†µ ìŠ¤íƒ€ì¼ */
        .top-header-buttons a {
            text-decoration: none;
            font-size: 14px;
            font-weight: bold;
            padding: 10px 16px;
            border-radius: 6px;
            border: 2px solid white;
            transition: 0.3s ease-in-out;
        }

        /* "ë‚´ ì •ë³´" ë²„íŠ¼ - íŒŒë€ìƒ‰ */
        .btn-profile {
            background: white;
            color: black;
        }

        .btn-profile:hover {
            background: blue;
            color: white;
        }

        /* "ë¡œê·¸ì•„ì›ƒ" ë²„íŠ¼ - ë¹¨ê°„ìƒ‰ */
        .btn-logout {
            background: white;
            color: black;
        }

        .btn-logout:hover {
            background: red;
            color: white;
        }

        /* ê¸°ëŠ¥ ì‚´í´ë³´ê¸° ë²„íŠ¼ */
        .btn-features {
            background: black;
            color: white;
        }

        .btn-features:hover {
            background: #333;
        }

    </style>


    <script>
        function logout() {
    console.log('ë¡œê·¸ì•„ì›ƒ ë©”ì„œë“œ ì‹¤í–‰ ');

    const metaTag = document.querySelector('meta[name="loginType"]');
    console.log('metaTag : ', metaTag);

    if (metaTag) {
        const loginType = metaTag.getAttribute('content'); // contentì—ì„œ ë¡œê·¸ì¸ íƒ€ì… ê°€ì ¸ì˜¤ê¸°
        console.log('loginType : ', loginType);

        let logoutUrl = '/jwt/security/logout'; // ê¸°ë³¸ ë¡œê·¸ì•„ì›ƒ URL
        let redirectUrl = '/'; // ê¸°ë³¸ ë¦¬ë‹¤ì´ë ‰íŠ¸ URL

        // loginTypeì— ë”°ë¥¸ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
        if (loginType === 'KAKAO') {
            console.log("ğŸ”¸ ì¹´ì¹´ì˜¤ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬");
            logoutUrl = '/oauth2/kakao/logout';
        } else if (loginType === 'NAVER') {
            console.log("ğŸ”¹ ë„¤ì´ë²„ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬");
            logoutUrl = '/oauth2/naver/logout';
        } else {
            console.warn("âš ï¸ ì§€ì›ë˜ì§€ ì•ŠëŠ” loginType ê°ì§€, ê¸°ë³¸ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬");
        }

        // ğŸ”‘ LocalStorageì—ì„œ í† í° ê°€ì ¸ì˜¤ê¸°
        const accessToken = localStorage.getItem("accessToken");
        const refreshToken = localStorage.getItem("refreshToken"); // í•„ìš”í•˜ë©´ ì €ì¥

        if (!accessToken) {
            console.warn("âš ï¸ ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨ - AccessTokenì´ ì—†ìŒ");
            alert("ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨: ë¡œê·¸ì¸ ìƒíƒœê°€ ì•„ë‹™ë‹ˆë‹¤.");
            return;
        }

        // ë¡œê·¸ì•„ì›ƒ ìš”ì²­
        fetch(logoutUrl, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${accessToken}`, // âœ… JWT í¬í•¨
                'Refresh-Token': refreshToken || '' // âœ… RefreshToken í¬í•¨ (í•„ìš”í•œ ê²½ìš°)
            },
            body: JSON.stringify({})
        })
        .then(response => {
            if (response.ok) {
                console.log(`âœ… ë¡œê·¸ì•„ì›ƒ ì„±ê³µ, ì´ë™í•  í˜ì´ì§€: ${redirectUrl}`);
                localStorage.removeItem("jwtToken"); // âœ… JWT ì‚­ì œ
                localStorage.removeItem("refreshToken"); // âœ… RefreshToken ì‚­ì œ
                window.location.href = redirectUrl; // "/" í˜ì´ì§€ë¡œ ì´ë™
            } else {
                console.error('âŒ ë¡œê·¸ì•„ì›ƒ ìš”ì²­ ì‹¤íŒ¨');
                alert('ë¡œê·¸ì•„ì›ƒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
        })
        .catch(error => {
            console.error('ğŸš¨ ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:', error);
            alert('ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        });
    } else {
        console.error('âš ï¸ loginType meta íƒœê·¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
    }
}
    </script>
</head>
<body>
<div class="header">
    <div class="header-title">Welcome Page</div>
    <div class="top-header-buttons">
        <a href="/profile" class="btn-profile">ë‚´ ì •ë³´</a>
        <a href="javascript:void(0);" onclick="logout()" class="btn-logout">ë¡œê·¸ì•„ì›ƒ</a>
    </div>
</div>

<div class="container">
    <h1>í™˜ì˜í•©ë‹ˆë‹¤! ğŸ‰</h1>
    <p>ì €í¬ ì›¹ì‚¬ì´íŠ¸ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤. ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ í™•ì¸í•´ë³´ì„¸ìš”.</p>
    <a href="/features" class="btn btn-custom btn-features">ê¸°ëŠ¥ ì‚´í´ë³´ê¸°</a>
</div>
</body>
</html>